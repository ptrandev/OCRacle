\documentclass[12pt, titlepage]{article}

\usepackage{amsmath, mathtools}

\usepackage[round]{natbib}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{colortbl}
\usepackage{xr}
\usepackage{hyperref}
\usepackage{longtable}
\usepackage{xfrac}
\usepackage{tabularx}
\usepackage{float}
\usepackage{siunitx}
\usepackage{booktabs}
\usepackage{multirow}
\usepackage[section]{placeins}
\usepackage{caption}
\usepackage{fullpage}

\hypersetup{
bookmarks=true,     % show bookmarks bar?
colorlinks=true,       % false: boxed links; true: colored links
linkcolor=red,          % color of internal links (change box color with linkbordercolor)
citecolor=blue,      % color of links to bibliography
filecolor=magenta,  % color of file links
urlcolor=cyan          % color of external links
}

\usepackage{array}

\externaldocument{../../SRS/SRS}

\input{../../Comments}
\input{../../Common}

\begin{document}

\title{Module Interface Specification for \progname{}}

\author{\authname}

\date{\today}

\maketitle

\pagenumbering{roman}

\section{Revision History}

\begin{tabularx}{\textwidth}{p{3cm}p{2cm}X}
\toprule {\bf Date} & {\bf Version} & {\bf Notes}\\
\midrule
March 13, 2025 & 1.0 & Initial Document Creation\\
\bottomrule
\end{tabularx}

~\newpage

\section{Symbols, Abbreviations and Acronyms}

See SRS Documentation at \url{https://github.com/ptrandev/OCRacle/blob/main/docs/SRS/SRS.pdf}
for symbols, abbreviations and acronyms.

\newpage

\tableofcontents

\newpage

\pagenumbering{arabic}

\section{Introduction}

The following document details the Module Interface Specifications for
\progname{}, an optical character recognition (OCR) program for identifying
Latin alphabet characters.

Complementary documents include the System Requirement Specifications
and Module Guide.  The full documentation and implementation can be
found at \url{https://github.com/ptrandev/OCRacle/}.

\section{Notation}

\wss{You should describe your notation.  You can use what is below as
  a starting point.}

The structure of the MIS for modules comes from \citet{HoffmanAndStrooper1995},
with the addition that template modules have been adapted from
\cite{GhezziEtAl2003}.  The mathematical notation comes from Chapter 3 of
\citet{HoffmanAndStrooper1995}.  For instance, the symbol := is used for a
multiple assignment statement and conditional rules follow the form $(c_1
\Rightarrow r_1 | c_2 \Rightarrow r_2 | ... | c_n \Rightarrow r_n )$.

The following table summarizes the primitive data types used by \progname. 

\begin{center}
\renewcommand{\arraystretch}{1.2}
\noindent 
\begin{tabular}{l l p{7.5cm}} 
\toprule 
\textbf{Data Type} & \textbf{Notation} & \textbf{Description}\\ 
\midrule
character & char & a single symbol or digit\\
integer & $\mathbb{Z}$ & a number without a fractional component in (-$\infty$, $\infty$) \\
natural number & $\mathbb{N}$ & a number without a fractional component in [1, $\infty$) \\
real & $\mathbb{R}$ & any number in (-$\infty$, $\infty$)\\
bounded real & $\mathbb{R}_{\text{min} \leq x \leq \text{max}}$ & a real number in the range [$\text{min}$, $\text{max}$]\\
bounded integer & $\mathbb{Z}_{\text{min} \leq x \leq \text{max}}$ & an integer in the range [$\text{min}$, $\text{max}$]\\
\bottomrule
\end{tabular} 
\end{center}

\noindent
The specification of \progname \ uses some derived data types: sequences, strings, and
tuples. Sequences are lists filled with elements of the same data type. Strings
are sequences of characters. Tuples contain a list of values, potentially of
different types. In addition, \progname \ uses functions, which
are defined by the data types of their inputs and outputs. Local functions are
described by giving their type signature followed by their specification.

\section{Module Decomposition}

The following table is taken directly from the Module Guide document for this project.

\begin{table}[h!]
\centering
\begin{tabular}{p{0.3\textwidth} p{0.6\textwidth}}
\toprule
\textbf{Level 1} & \textbf{Level 2}\\
\midrule

{Hardware-Hiding Module} & ~ \\
\midrule

\multirow{8}{0.3\textwidth}{Behaviour-Hiding Module} &
Input Format Module\\
& Model Output Module\\
& Model Training Module\\
& Model Testing Module\\
& Prediction Model Module\\
& Application Module\\
& Image Preprocessing Module\\
& Accuracy Metrics Module\\
\midrule

\multirow{1}{0.3\textwidth}{Software Decision Module}&
Graphical User Interface Module\\
\bottomrule

\end{tabular}
\caption{Module Hierarchy}
\label{TblMH}
\end{table}

\newpage
~\newpage

\section{MIS of Application Module} \label{MApplication}

\subsection{Module}

main

\subsection{Uses}

\begin{itemize}
  \item Graphical User Interface Module \ref{MGUI}
  \item Input Format Module \ref{MInput}
  \item Model Output Module \ref{MOutput}
\end{itemize}

\subsection{Syntax}

\subsubsection{Exported Constants}

N/A

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{2cm} p{4cm} p{4cm} p{2cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
main & - & - & - \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}

N/A

\subsubsection{Environment Variables}

N/A

\subsubsection{Assumptions}

The Graphical User Interface module is responsible for handling all user
inputs and outputs. The Application module is responsible for coordinating the
interaction between the GUI, Input Format, and Model Output modules.

\subsubsection{Access Routine Semantics}

\noindent main():
\begin{itemize}
\item transition: The application is started and the user is able to interact
with the GUI to input images and view the model's predictions.
\end{itemize}


\subsubsection{Local Functions}

N/A

\section{MIS of Input Format Module} \label{MInput}

\subsection{Module}

input

\subsection{Uses}

\begin{itemize}
  \item Image Preprocessing Module \ref{mPreprocessing}
\end{itemize}

\subsection{Syntax}

\subsubsection{Exported Constants}

N/A

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{2cm} p{2cm} p{3cm} p{6cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
input & filePath: string & imageMatrix: $\mathbb{Z}^{28 \times 28}_{0 \le x \le 255}$ & DimensionsError, FormatError, FileNotFound \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}

N/A

\subsubsection{Environment Variables}

\begin{itemize}
  \item filePath: string. The path to the input image file from the user.
\end{itemize}

\subsubsection{Assumptions}

N/A

\subsubsection{Access Routine Semantics}

\noindent input(filePath):
\begin{itemize} 
\item output: imageMatrix := preprocessing(filePath). After ensuring that all
exceptions are handled, call the preprocessing module \ref{mPreprocessing} to
perform the necessary transformations on the input image.
\item exceptions:
\begin{itemize}
  \item A DimensionsError exception is thrown if the input image
  exceeds the bounds of the $n_{min}$, $n_{max}$, $m_{min}$, and $m_{max}$
  parameters as specified by Table 4 in the SRS \cite[4.2.6]{SRS}.
  \item A FormatError exception is thrown if the input image is not one of the supported formats
  specified by R1 in the SRS \cite[5.1.1]{SRS}.
  \item A FileNotFound exception is thrown if the input file does not exist.
\end{itemize}
\end{itemize}

\subsubsection{Local Functions}

N/A

\section{MIS of Model Output Module} \label{MOutput}

\subsection{Module}

output
\subsection{Uses}

\begin{itemize}
  \item Prediction Model Module \ref{MModel}
\end{itemize}


\subsection{Syntax}

\subsubsection{Exported Constants}

\begin{itemize}
  \item LABELS: \{'A',...,'Z'\}
\end{itemize}

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{2cm} p{4cm} p{4cm} p{2cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
output & imageMatrix: $\mathbb{Z}^{28 \times 28}_{0 \le x \le 255}$ & prediction: char, confidenceMatrix: $\mathbb{R}_{\text{0} \leq \text{x} \leq \text{1}}^{26}$ & - \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}

N/A

\subsubsection{Environment Variables}

N/A

\subsubsection{Assumptions}

We assume that the imageMatrix input has been processed by the Input Format
Module \ref{MInput} before being passed to the Model Output Module.

\subsubsection{Access Routine Semantics}

\noindent output(imageMatrix):
\begin{itemize}
\item output:
\begin{itemize}
  \item confidenceMatrix := predict(imageMatrix). Call the prediction model
  module \ref{MModel} to generate a confidence matrix for the input image.
  \item prediction := LABELS[argmax(confidenceMatrix)]. Return the character
  representing the highest confidence value in the confidence matrix.
\end{itemize}
\end{itemize}

\section{MIS of Model Training Module} \label{MTraining}

\subsection{Module}

train

\subsection{Uses}

\begin{itemize}
  \item Input Format Module \ref{MInput}
  \item Model Output Module \ref{MOutput}
  \item Prediction Model Module \ref{MModel}
  \item Accuracy Metrics Module \ref{mAccuracy}
\end{itemize}

\subsection{Syntax}

\subsubsection{Exported Constants}

N/A

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{2cm} p{4cm} p{4cm} p{2cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
train & - & model: $\mathbb{R}^{m \times n}$ & - \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}

\begin{itemize}
  \item dataset: ($\mathbb{Z}^{28 \times 28}_{0 \le x \le 255}$, char)[]
  \item epochs: $\mathbb{N}$
  \item batch\_size: $\mathbb{N}$
  \item learning\_rate: $\mathbb{R}$
  \item epsilon: $\mathbb{R}$
  \item time\_step: $\mathbb{R}$
  \item first\_moment: $\mathbb{R}$
  \item second\_moment: $\mathbb{R}$
  \item beta1: $\mathbb{R}$
  \item beta2: $\mathbb{R}$
  \item gradient: $\mathbb{R}^{m \times n}$
  \item theta: $\mathbb{R}^{m \times n}$
  \item y\_hat: $\mathbb{R}^{m \times n}$
\end{itemize}

\subsubsection{Environment Variables}

N/A

\subsubsection{Assumptions}

N/A

\subsubsection{Access Routine Semantics}

\noindent train():
\begin{itemize}
\item transition: The model is trained on the dataset using the hyperparameters
epochs, batch\_size, learning\_rate, epsilon, time\_step, first\_moment,
second\_moment, beta1, and beta2. These are manipulated via the ADAM optimizer
as specified by the SRS.
\item output: model := $f_{train}()$
\end{itemize}

\subsubsection{Local Functions}

\noindent relu(x):
\begin{itemize}
\item output: result := max(0, x)
\end{itemize}

\noindent softmax(x):
\begin{itemize}
\item output: result := $e^{x} / \sum_{i=1}^{n} e^{x_i}$
\end{itemize}

\noindent cnn\_forward(x, theta):
\begin{itemize}
\item transition: y\_hat := $f_{cnn\_forward}(x, theta)$. This function
calculates the output of the model given the input x and the weights theta.
\end{itemize}

\noindent cnn\_backward(x, y, y\_hat, theta):
\begin{itemize}
\item transition: gradient := $f_{cnn\_backward}(x, y, y\_hat, theta)$. This
function calculates the gradient of the model given the input x, the target y,
the output y\_hat, and the weights theta.
\end{itemize}

\noindent updateTheta(gradient, theta, time\_step, first\_moment, second\_moment, beta1, beta2, epsilon):
\begin{itemize}
\item transition: theta := $f_{updateTheta}(gradient, theta, time\_step, first\_moment, second\_moment, beta1, beta2, epsilon)$. This function updates the weights of the model using the ADAM optimizer.
\end{itemize}


\section{MIS of Model Testing Module} \label{MTesting}

\subsection{Module}

test

\subsection{Uses}

\begin{itemize}
  \item Accuracy Metrics Module \ref{mAccuracy}
  \item Model Output Module \ref{MOutput}
  \item Input Format Module \ref{MInput}
\end{itemize}

\subsection{Syntax}

\subsubsection{Exported Constants}

N/A

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{2cm} p{2cm} p{6cm} p{2cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
test & - & loss: $\mathbb{R_{\text{0} \leq \text{x} \leq \text{1}}}$, accuracy: $\mathbb{R_{\text{0} \leq \text{x} \leq \text{1}}}$, confusionMatrix: $\mathbb{R_{\text{0} \leq \text{x} \leq \text{1}}}^{26 \times 26}$ & - \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}

\begin{itemize}
  \item dataset: ($\mathbb{Z}^{28 \times 28}_{0 \le x \le 255}$, char)[]. The
  dataset of images and their corresponding labels used for testing the model.
  \item loss: $\mathbb{R_{\text{0} \leq \text{x} \leq \text{1}}}$. The
  cross-entropy loss of the model, which is a measure of the model's performance.
  \item confusionMatrix: $\mathbb{R_{\text{0} \leq \text{x} \leq \text{1}}}^{26 \times 26}$. A matrix that shows the model's predictions versus the actual labels.
\end{itemize}

\subsubsection{Environment Variables}

N/A

\subsubsection{Assumptions}

Assume that the model has been trained using the Model Training Module
\ref{MTraining}.

\subsubsection{Access Routine Semantics}

\noindent test():
\begin{itemize}
\item transition: The model is tested on a dataset of unseen images. The loss,
and confusion matrix are calculated using the model's predictions.
\item output:
\begin{itemize}
  \item loss := crossEntropyLoss(prediction, target). The prediction from the
  model is compared to the true target values from the dataset. The Accuracy
  Metrics Module \ref{mAccuracy} is used to calculate the cross-entropy loss.
  \item confusionMatrix := confusionMatrix(prediction, target). The prediction
  from the model is compared to the true target values from the dataset. The
  Accuracy Metrics Module \ref{mAccuracy} is used to calculate the confusion
  matrix.
\end{itemize}

\subsubsection{Local Functions}

N/A


\section{MIS of Prediction Model Module} \label{MModel}

\subsection{Module}

model

\subsection{Uses}


\subsection{Syntax}

\subsubsection{Exported Constants}

N/A

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{2cm} p{4cm} p{4cm} p{2cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
predict & imageMatrix: $\mathbb{Z}^{28 \times 28}_{0 \le x \le 255}$ & confidenceMatrix: $\mathbb{R}_{\text{0} \leq \text{x} \leq \text{1}}^{26}$ & - \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}

\begin{itemize}
  \item model: $\mathbb{R}^{m \times n}$. The representation of the model's
  weights for the prediction model.
\end{itemize}

\subsubsection{Environment Variables}

N/A

\subsubsection{Assumptions}

We assume that the input image has been preprocessed as specified in the SRS
before being passed to the prediction model.


\subsubsection{Access Routine Semantics}

\noindent predict(imageMatrix):
\begin{itemize}
\item output: confidenceMatrix. Where each element in the confidence matrix
represents the model's confidence in the corresponding character. The model is
used to generate a confidence matrix for the input image using a CNN as
specified by GD3 in the SRS \cite[4.2.3]{SRS}. GD3 provides a high-level
description of the model's architecture, but the implemented model may differ.
\end{itemize}


\subsubsection{Local Functions}

N/A

\section{MIS of Image Preprocessing Module} \label{mPreprocessing}

\subsection{Module}

preprocessing

\subsection{Uses}

\subsection{Syntax}

\subsubsection{Exported Constants}

N/A

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{3cm} p{3cm} p{4cm} p{2cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
preprocessing & file : string & imageMatrix: $\mathbb{Z}^{28 \times 28}_{0 \le x \le 255}$ & - \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}

N/A

\subsubsection{Environment Variables}

N/A

\subsubsection{Assumptions}

All input data has been validated by the Input Format Module before being
processed by the Image Preprocessing Module.

\subsubsection{Access Routine Semantics}

\noindent preprocessing(file):
\begin{itemize} 
\item output: imageMatrix := normalization(bicubicInterpolation(file)). The
input file has been transformed such that it conforms to the preprocessing
requirements as specified by A3 in the SRS \cite[4.2.1]{SRS}.
\end{itemize}

\subsubsection{Local Functions}

\noindent bicubicInterpolation(imageMatrix):
\begin{itemize}
\item output: Perform bicubic interpolation such that the imageMatrix is
transformed to a 28x28 matrix. as specified by TM:BI in the SRS \cite[4.2.2]{SRS}.
\end{itemize}
\noindent normalization(imageMatrix):
\begin{itemize}
\item output: Perform normalization such that the image is turned into a
greyscale image with pixel values in the range [0, 255]. as specified by TM:N in
the SRS \cite[4.2.2]{SRS}.
\end{itemize}

\section{MIS of Accuracy Metrics Module} \label{mAccuracy}

\subsection{Module}

performance

\subsection{Uses}


\subsection{Syntax}

\subsubsection{Exported Constants}

N/A

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{4cm} p{4cm} p{4cm} p{2cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
crossEntropyLoss & prediction: $\mathbb{R}_{\text{0} \leq \text{x} \leq \text{1}}^{26}$, target: $\mathbb{R}_{\text{0} \leq \text{x} \leq \text{1}}^{26}$ & loss: $\mathbb{R_{\text{0} \leq \text{x} \leq \text{1}}}$ & DimensionsError \\
confusionMatrix & prediction: $\mathbb{R}_{\text{0} \leq \text{x} \leq \text{1}}^{26}$, target: $\mathbb{R}_{\text{0} \leq \text{x} \leq \text{1}}^{26}$ & confusionMatrix: $\mathbb{R_{\text{0} \leq \text{x} \leq \text{1}}}^{26 \times 26}$ & DimensionsError \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}

N/A

\subsubsection{Environment Variables}

N/A

\subsubsection{Assumptions}

N/A

\subsubsection{Access Routine Semantics}

\noindent crossEntropyLoss(prediction, target):
\begin{itemize}
\item output: loss := $- \sum_{i=1}^{n} target_i \log(prediction_i)$. The cross
entropy loss is calculated for the model's predictions and the target values
as specified by TM:CELF in the SRS \cite[4.2.2]{SRS}.
\item exceptions:
\begin{itemize}
  \item A DimensionsError exception is thrown if the dimensions of the prediction
  and target matrices do not match.
\end{itemize}
\end{itemize}

\noindent confusionMatrix(prediction, target):
\begin{itemize}
\item output: confusionMatrix := $\text{confusionMatrix}_{i,j} = \sum_{k=1}^{n} \text{target}_{k,i} \times \text{prediction}_{k,j}$. A confusion matrix is generated for the
model's predictions and the target values to fulfill NFR1 in the SRS
\cite[5.2]{SRS}.
\item exceptions:
\begin{itemize}
  \item A DimensionsError exception is thrown if the dimensions of the prediction
  and target matrices do not match.
\end{itemize}
\end{itemize}

\subsubsection{Local Functions}

N/A

\section{MIS of Graphical User Interface Module} \label{MGUI}

\subsection{Module}

gui
\subsection{Uses}

\begin{itemize}
  \item Hardware-Hiding Module
\end{itemize}

\subsection{Syntax}

\subsubsection{Exported Constants}

N/A

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{2cm} p{4cm} p{4cm} p{2cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
- & - & - & - \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}

N/A

\subsubsection{Environment Variables}

\begin{itemize}
  \item displayWindow (dimensions: $\mathbb{Z}_+ \times \mathbb{Z}_+$)
  \item keyboard (keypress: char)
  \item mouse (location : $\mathbb{Z}_+ \times \mathbb{Z}_+$, click: bool)
\end{itemize}

\subsubsection{Assumptions}

This behavior will be sufficiently abstracted by the use of Python Notebook,
which will handle all UI elements and interactions with the user. As a result,
the GUI modules does not need to have any pre-defined state variables or access
routines.

\subsubsection{Access Routine Semantics}

N/A

\subsubsection{Local Functions}

N/A

\newpage

\bibliographystyle {plainnat}
\bibliography {../../../refs/References}

\newpage

\section{Appendix} \label{Appendix}

\wss{Extra information if required}

\newpage{}

\end{document}